<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <title>Pathfinder</title>
  <link rel="icon" type="image/gif" href="images/favicon.gif" />
  <link rel="stylesheet" href="style.css">
  <!-- <script src="script.js"></script> -->
</head>
<body>
<table id="onglets" style="width: 100%;">
   <tr>
       <td id="ongletFP" style="width: 50%;border: 1px solid black;" onClick="change('fp')">fichee perso</td>
       <td id="ongletReglage" style="width: 50%;" onClick="change('reglage')">reglages</td>
   </tr>
</table>
<span id="reglage">
<button id="add" onClick="addLine()">Ajouter</button>
<form>
  <table id="table" >
   <tr>
       <td>Nom</td>
       <td>Valeur</td>
       <td>Effet</td>
	   <td>Lien</td>
   </tr>
   <tr>
       <td><input type='text' name='nom' id='nom0' size='10' index='0' onchange='tableReglages[0][0]=this.value;'/></td>
       <td><input class="number" type='number' name='valeur' id='valeur0' size='3' index='0' onchange='tableReglages[0][1]=this.value'/><//></td>
       <td><select name='effet' id='effet0' index='0' onchange='tableReglages[0][2]=this.value'/></>
			<optgroup label='Caractéristiques'>
				<option value='for'>Force</option>
				<option value='dex'>Dextérité</option>
				<option value='con'>Constitution</option>
				<option value='int'>Intelligence</option>
				<option value='sag'>Sagesse</option>
				<option value='cha'>Charisme</option>
			</optgroup>
			<optgroup label='Attaque'>
				<option value='bba'>BBA</option>
				<option value='cac'>CàC</option>
				<option value='dist'>Distance</option>
				<option value='BMC'>BMC</option>
			</optgroup>
			<optgroup label='Défense'>
				<option value='catot'>CA Totale</option>
				<option value='cacon'>CA de contact</option>
				<option value='casur'>CA surpris</option>
				<option value='pv'>PV</option>
			</optgroup>
       </select></td>
       <td><select name='rattachement' id='rattachement0' index='0' onClick='genereRattachement(this)'; onchange='tableReglages[0][3]=this.value'/></>
			<option value='None'>Aucun</option>
       </select></td>
   </tr>
</table>
</form>

</span>
<span id="fp" style="display:none">
ok
	<span id="check">
		<input type="checkbox" name="frites" id="frites" /> <label for="frites">Frites</label><br />

       <input type="checkbox" name="steak" id="steak" /> <label for="steak">Steak haché</label><br />

       <input type="checkbox" name="epinards" id="epinards" /> <label for="epinards">Epinards</label><br />

       <input type="checkbox" name="huitres" id="huitres" /> <label for="huitres">Huitres</label>

	</span>
</span>
</body>
</html>
<script>
	var nb_lignes=1;
	var tableReglages=new Array(new Array(0,0,"for","None"));
	var effects= new Array();
	effects["Caractéristiques"]=new Array(new Array('for','Force'),new Array('dex','Dextérité'),new Array('con','Constitution'),new Array('int','Intelligence'),new Array('sag','Sagesse'),new Array('cha','Charisme'))
	effects["Attaque"]=new Array(new Array('bba','BBA'),new Array('cac','CàC'),new Array('dist','Distance'),new Array('BMC','BMC'))
	effects["Défense"]=new Array(new Array('catot','CA Totale'),new Array('cacon','CA de contact'),new Array('casur','CA surpris'),new Array('pv','PV'))
	function test(a,b,id){
		tableReglages[a][b]=document.getElementById(id).value;
	}
	
	function genereCheck(){
		elem=document.getElementById("check");
		while (elem.children.length>0) {
			elem.children[0].remove();
		}
		var nouveauNode;
		for(var i in tableReglages){
			if(tableReglages[tableReglages.length-1-i][3]=='None'){
				nouveauOption=document.createElement('option');
				nouveauOption.value=tableReglages[tableReglages.length-1-i][0];
				nouveauOption.innerHTML=tableReglages[tableReglages.length-1-i][0];
				
				nouveauNode=document.createElement('input');
				nouveauNode.type='checkbox';
				nouveauNode.name=tableReglages[tableReglages.length-1-i][0];
				nouveauNode.id=tableReglages[tableReglages.length-1-i][0];
				elem.appendChild(nouveauNode);
				
				nouveauNode=document.createElement('label');
				nouveauNode.setAttribute('for',tableReglages[tableReglages.length-1-i][0]);
				nouveauNode.innerHTML=tableReglages[tableReglages.length-1-i][0];
				elem.appendChild(nouveauNode);
				
				nouveauNode=document.createElement('br');
				elem.appendChild(nouveauNode);
				
				
			}
		}
	}
	
	function genereRattachement(elem){
		console.log(elem.value);
		valeur=elem.value;
		while (elem.children.length>0) {
			elem.children[0].remove();
		}
		var nouveauOption=document.createElement('option');
		nouveauOption.value='None';
		nouveauOption.innerHTML="Aucun";
		elem.appendChild(nouveauOption);
		
		for(var i in tableReglages){
			if(!(i==elem.getAttribute('index')) && tableReglages[i][3]=='None'){
				nouveauOption=document.createElement('option');
				nouveauOption.value=tableReglages[i][0];
				nouveauOption.innerHTML=tableReglages[i][0];
				elem.appendChild(nouveauOption);
			}
		}
		for(var i in elem.children){
			if (elem.children[i].value==valeur){
				elem.children[i].selected=true;
				
				console.log(valeur+"ok");
			}
		}
	}
	
	function newEffect(num){
		nouveauEffect= document.createElement('select');
		nouveauEffect.name='Effet';
		nouveauEffect.id='Effet'+num;
		var nouveauOptGroup;
		var nouveauOption;
		for(var indice in effects){
			nouveauOptGroup=document.createElement('optgroup');
			nouveauOptGroup.label=indice;
			for (var i in effects[indice]){
				nouveauOption=document.createElement('option');
				nouveauOption.value=effects[indice][i][0];
				nouveauOption.innerHTML=effects[indice][i][1];
				nouveauOptGroup.appendChild(nouveauOption);
			}
			
			nouveauEffect.appendChild(nouveauOptGroup);
		}
		return nouveauEffect;
	}
	
	function addLine(){
		console.log(tableReglages);
		var table=document.getElementById("table");
		var row=table.insertRow(1);
		tableReglages[nb_lignes]=new Array(0,0,"for","None");
		
		var cell0=row.insertCell(0);
		var cell1=row.insertCell(1);
		var cell2=row.insertCell(2);
		var cell3=row.insertCell(3);
		
		
		var nouveauInput= document.createElement('input');
		nouveauInput.name = 'nom';
		nouveauInput.id = 'nom'+nb_lignes;
		nouveauInput.type = 'text';
		nouveauInput.size = 10;
		nouveauInput.setAttribute("index", nb_lignes);
		nouveauInput.onchange=function(){tableReglages[this.getAttribute('index')][0]=this.value;};
		cell0.appendChild(nouveauInput);
		
		nouveauInput= document.createElement('input');
		nouveauInput.classList.add('number');
		nouveauInput.name = 'valeur';
		nouveauInput.id = 'valeur'+nb_lignes;
		nouveauInput.type = 'number';
		nouveauInput.setAttribute("index", nb_lignes);
		nouveauInput.onchange=function(){tableReglages[this.getAttribute('index')][1]=this.value;};
		cell1.appendChild(nouveauInput);
		
		
		nouveauInput=newEffect(nb_lignes);
		nouveauInput.setAttribute("index", nb_lignes);
		nouveauInput.onchange=function(){tableReglages[this.getAttribute('index')][2]=this.value;};
		cell2.appendChild(nouveauInput);
		
		nouveauInput=document.createElement('select');
		nouveauInput.name='rattachement';
		nouveauInput.id='rattachement'+nb_lignes;
		nouveauInput.setAttribute("index", nb_lignes);
		nouveauInput.onchange=function(){tableReglages[this.getAttribute('index')][3]=this.value;};
		nouveauInput.onclick=function(){genereRattachement(this);};
		
		nouveauOption=document.createElement('option');
		nouveauOption.value='None';
		nouveauOption.innerHTML="Aucun";
		
		nouveauInput.appendChild(nouveauOption);
		
		
		cell3.appendChild(nouveauInput);
		
		
		nb_lignes++;
	}
	
	function change(visible){
		if (visible=="fp"){
			document.getElementById("reglage").style.display="none";
			document.getElementById("fp").style.display="inline";		
			document.getElementById("ongletReglage").style.border="1px solid black";
			document.getElementById("ongletFP").style.border="0px";	
			genereCheck();
		}
		else{
			document.getElementById("fp").style.display="none";
			document.getElementById("reglage").style.display="inline";	
			document.getElementById("ongletFP").style.border="1px solid black";
			document.getElementById("ongletReglage").style.border="0px";	
			
		}
	}
	
</script>
